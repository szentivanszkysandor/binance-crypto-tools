<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Market Trades Checker – Live (Binance)</title>
  <style>
    :root{--bg:#0b1220; --panel:#0f1629; --fg:#e6edf3; --muted:#8da2c0; --line:#1b2336;--ok:#26a69a; --err:#ef5350;}
    *{ box-sizing:border-box }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial,sans-serif;margin:0; background:var(--bg); color:var(--fg);}
    header{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; padding:12px 16px; border-bottom:1px solid #223 }
    header h1{ font-size:16px; margin:0 8px 0 0; font-weight:600 }
    .toolbar{ display:flex; flex-wrap:wrap; gap:8px; align-items:center }
    input,select,button,textarea{background:var(--panel); border:1px solid #2a3550; color:var(--fg);border-radius:10px; padding:8px 10px;}
    input::placeholder, textarea::placeholder{ color:#9fb1cf }
    button{ cursor:pointer }
    .tag{ font-size:12px; border:1px solid #2a3550; border-radius:999px; padding:2px 8px }
    .muted{ color:var(--muted); font-size:12px }
    main{ padding:14px 16px }
    .grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(360px,1fr)); gap:12px }
    .card{background:var(--panel); border:1px solid var(--line);border-radius:14px; overflow:hidden; display:flex; flex-direction:column; min-width:0;}
    .card .head{ border-bottom:1px solid var(--line); padding:10px 12px }
    .card .head-top{display:grid;grid-template-columns:auto 1fr auto auto; /* pill | grow | price | close */gap:8px; align-items:center;}
    .pill{font-weight:700; letter-spacing:.3px;border-radius:999px; padding:4px 10px;background:#0e1a2e; border:1px solid #223552;}
    .grow{ flex:1 }
    .price{ font-weight:700 }
    .close{background:#1a243b; border:1px solid #2b3759;border-radius:8px; padding:4px 8px; cursor:pointer;}
    .card .head-bottom{margin-top:6px; min-height:18px;display:flex; justify-content:center; align-items:center;}
    .status{ font-size:12px; color:var(--muted) }
    .tblwrap{ overflow:auto; max-height:600px }
    table{ width:100%; border-collapse:collapse; font-variant-numeric:tabular-nums }
    th,td{ padding:8px 10px; border-bottom:1px solid var(--line); text-align:right; white-space:nowrap; font-size:13px }
    th{ text-align:right; color:var(--muted); font-weight:600; position:sticky; top:0; background:var(--panel); z-index:1 }
    th:first-child, td:first-child{ text-align:left }
    tr.up td{ color:var(--ok) }
    tr.down td{ color:var(--err) }
    .drawer{position:fixed; right:16px; top:64px; width:460px; max-width:95vw; max-height:86vh; overflow:auto;background:var(--panel); border:1px solid #1b2336; border-radius:12px; box-shadow:0 10px 40px rgba(0,0,0,.5);padding:12px; display:none; z-index:50;}
    .drawer.open{ display:block }
    .row{ display:flex; gap:8px; align-items:center; margin:8px 0 }
    .row label{ flex:1 }
    .row input, .row textarea{ flex:1 }
    .drawer h3{ margin:4px 0 8px 0 }
    .drawer small{ color:var(--muted) }
    .btns{ display:flex; gap:8px; justify-content:flex-end; margin-top:10px }
    .drawer ul{ margin:6px 0 6px 18px }
  </style>
</head>
<body>
  <header>
    <h1>Market Trades Checker – Live (Binance)</h1>
    <div class="toolbar">
      <label>Pairs (comma-separated): <input id="symbols" placeholder="e.g. BTCUSDC,ETHUSDC,BNBUSDC,SOLUSDC" style="width:280px"/></label>
      <label>Max rows: <input id="limit" type="number" value="25" min="25" max="250" style="width:90px"/></label>
      <button id="addBtn">Add</button>
      <button id="clearBtn">Close all cards</button>
      <button id="btnSettings">⚙️ Settings</button>
      <button id="btnHelp">❓ Help</button>
      <span class="tag muted">Default: <span id="defaultBadge">—</span></span>
    </div>
  </header>

  <main>
    <div id="grid" class="grid"></div>
  </main>

  <div id="settings" class="drawer" aria-label="Settings">
    <h3>Defaults</h3>
    <div class="row">
      <label for="defPairs">Default pairs (comma-separated):</label>
      <textarea id="defPairs" rows="3" placeholder="e.g. BTCUSDC,ETHUSDC,BNBUSDC,SOLUSDC"></textarea>
    </div>
    <div class="row">
      <label for="defLimit">Default max rows:</label>
      <input id="defLimit" type="number" min="25" max="250" />
    </div>
    <small>“Save + apply now” bezárja a kártyákat és megnyitja a (max 4) default párokat, deduplikálva.</small>
    <div class="btns">
      <button id="btnSaveDefaults">Save</button>
      <button id="btnApplyDefaults">Save + apply now</button>
      <button id="btnCloseSettings">Close</button>
    </div>
  </div>

  <div id="help" class="drawer" aria-label="Help">
    <h2>User Guide</h2>
<h3>What is this?</h3>
<p>
  <b>Market Trades Checker – Live (Binance)</b> shows real-time Binance Spot trades for up to
  <b>four</b> symbols side by side. Each symbol opens as a <i>card</i> with a live price, status, and a scrolling trade table. Green rows are buy-side takers, red rows are sell-side takers.
</p>

<h3>Quick start</h3>
<ol>
  <li>Type symbols in <b>Pairs</b> (comma or space separated), e.g. <code>BTCUSDC, ETHUSDC</code>, then click <b>Add</b> (Enter also works).</li>
  <li>Use <b>Max rows</b> to cap the table length (25–250). New trades appear at the top.</li>
  <li><b>Close all cards</b> clears the screen. In <b>Settings</b> you can save default pairs and row limit; <i>Save + apply now</i> instantly reopens those defaults (deduped, max 4).</li>
</ol>

<h3>What you see on each card</h3>
<ul>
  <li><b>Header</b>: symbol pill, live <b>Price</b>, close button, and a status line (<i>Connecting…</i> → <i>Live</i>). Prices are formatted to the symbol’s precision.</li>
  <li><b>Trades table</b> (latest first):
    <ul>
      <li><b>Price (quote)</b> — trade price</li>
      <li><b>Quantity (base)</b> — traded amount</li>
      <li><b>Time</b> — local time of the trade</li>
    </ul>
    Green row = taker buy, red row = taker sell.
  </li>
</ul>

<h3>How to read it (quick)</h3>
<ul>
  <li><b>Who’s pushing?</b> More green rows and fast prints at rising prices usually mean buyers are in control; more red at slipping prices suggests sellers lead.</li>
  <li><b>Watch sequences, not one tick.</b> A steady run of green/red tells you more than a single spike.</li>
  <li><b>Compare symbols.</b> Open up to four cards to see where flow is strongest right now.</li>
</ul>

<h3>Tips & troubleshooting</h3>
<ul>
  <li><b>Just opened?</b> Status shows <i>Connecting…</i> briefly; it turns <i>Live</i> on the first tick. If a market has no <code>@trade</code> ticks, the app auto-switches to <code>@aggTrade</code>.</li>
  <li><b>Nothing shows?</b> Check the symbol (e.g., <code>BTCUSDC</code>); try removing and re-adding the card.</li>
  <li><b>Need fewer rows?</b> Lower <b>Max rows</b> or hit <b>Close all cards</b> and reopen your defaults from <b>Settings</b>.</li>
</ul>

    <div class="btns"><button id="btnCloseHelp">Close</button></div>
  </div>

  <script>
  (()=>{

    // ---------- Storage ---------- //
    const LS = {
      list:'msl_symlist', limit:'msl_limit', lastInput:'msl_lastInput',
      defPairs:'msl_defaults_pairs', defLimit:'msl_defaults_limit'
    };
    const DEFAULT_FALLBACK_PAIRS = ['BTCUSDC','ETHUSDC','BNBUSDC','SOLUSDC'];
    const DEFAULT_FALLBACK_LIMIT = 25;

    // ---------- DOM ---------- //
    const grid = document.getElementById('grid');
    const symbolsInput = document.getElementById('symbols');
    const limitEl = document.getElementById('limit');
    const addBtn = document.getElementById('addBtn');
    const clearBtn = document.getElementById('clearBtn');
    const defaultBadge = document.getElementById('defaultBadge');

    const drawer = document.getElementById('settings');
    const btnSettings = document.getElementById('btnSettings');
    const btnCloseSettings = document.getElementById('btnCloseSettings');
    const btnSaveDefaults = document.getElementById('btnSaveDefaults');
    const btnApplyDefaults = document.getElementById('btnApplyDefaults');
    const defPairsEl = document.getElementById('defPairs');
    const defLimitEl = document.getElementById('defLimit');

    const helpDrawer = document.getElementById('help');
    const btnHelp = document.getElementById('btnHelp');
    const btnCloseHelp = document.getElementById('btnCloseHelp');

    // ---------- State ---------- //
    const active = new Map();

    // ---------- Defaults ---------- //
    function loadUserDefaults(){
      let pairs = DEFAULT_FALLBACK_PAIRS.slice();
      let limit = DEFAULT_FALLBACK_LIMIT;
      try{
        const p = JSON.parse(localStorage.getItem(LS.defPairs)||'null');
        if (Array.isArray(p) && p.length) pairs = p.map(s=>String(s).toUpperCase().trim()).filter(Boolean);
      }catch{}
      const l = Number(localStorage.getItem(LS.defLimit));
      if (!Number.isNaN(l) && l>=25 && l<=250) limit = Math.floor(l);
      return {pairs, limit};
    }
    function updateDefaultBadge(){
      const {pairs, limit} = loadUserDefaults();
      defaultBadge.textContent = `${pairs.join(', ')} · Max: ${limit}`;
    }
    function loadList(){
      try{
        const j = JSON.parse(localStorage.getItem(LS.list)||'null');
        if (Array.isArray(j) && j.length) return j.slice(0,4);
      }catch{}
      return loadUserDefaults().pairs.slice(0,4);
    }
    function saveList(){
      try{ localStorage.setItem(LS.list, JSON.stringify([...active.keys()])); }catch{}
    }
    function loadLimit(){
      const lStored = Number(localStorage.getItem(LS.limit));
      if (!Number.isNaN(lStored)) {
        limitEl.value = Math.max(25, Math.min(250, lStored));
        return;
      }
      const {limit} = loadUserDefaults();
      limitEl.value = limit;
    }
    function saveLimit(){ try{ localStorage.setItem(LS.limit, String(limitEl.value)); }catch{} }

    symbolsInput.value = localStorage.getItem(LS.lastInput)||'';
    symbolsInput.addEventListener('input', ()=> localStorage.setItem(LS.lastInput, symbolsInput.value));
    limitEl.addEventListener('input', saveLimit);
    symbolsInput.addEventListener('keydown', e=>{ if(e.key==='Enter') addSymbolsFromInput(); });

    // ---------- Helpers ---------- //
    function idsFor(sym){
      const id = sym.toUpperCase();
      return { card:'card_'+id, price:'price_'+id, status:'status_'+id, tbody:'tbody_'+id };
    }
    function setStatus(sym, text){
      const ids = idsFor(sym);
      const el = document.getElementById(ids.status);
      if (el) el.textContent = text;
    }
    function humanTime(ts){
      const d = new Date(Number(ts));
      return isNaN(d.getTime()) ? '—'
        : d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', second:'2-digit'});
    }
    async function fetchExchangeInfo(sym){
      const ctrl=new AbortController(); const t=setTimeout(()=>ctrl.abort(),5000);
      try{
        const r=await fetch(`https://api.binance.com/api/v3/exchangeInfo?symbol=${encodeURIComponent(sym)}`,{cache:'no-store',signal:ctrl.signal});
        if(!r.ok) return null;
        const j=await r.json(); const s=(j.symbols&&j.symbols[0])||null; if(!s) return null;
        const filters=s.filters||[];
        const pf=filters.find(f=>f.filterType==='PRICE_FILTER');
        const lf=filters.find(f=>f.filterType==='LOT_SIZE');

        let priceDecimals=8;
        if (pf && typeof pf.tickSize==='string'){
          const ts=pf.tickSize;
          priceDecimals = ts.indexOf('.')===-1 ? 0 : Math.max(0, ts.replace(/0+$/,'').split('.')[1].length);
        }else if (typeof s.pricePrecision==='number'){
          priceDecimals = s.pricePrecision;
        }
        let qtyDecimals=8;
        if (lf && typeof lf.stepSize==='string'){
          const qs=lf.stepSize;
          qtyDecimals = qs.indexOf('.')===-1 ? 0 : Math.max(0, qs.replace(/0+$/,'').split('.')[1].length);
        }else if (typeof s.baseAssetPrecision==='number'){
          qtyDecimals = s.baseAssetPrecision;
        }
        priceDecimals = Math.min(8, Math.max(0, priceDecimals));
        qtyDecimals   = Math.min(8, Math.max(0, qtyDecimals));
        return { priceDecimals, qtyDecimals };
      }finally{ clearTimeout(t); }
    }
    function fmtQty(q,d){ const digits=Math.min(8,Math.max(0, d==null?8:d)); return Number(q).toLocaleString(undefined,{maximumFractionDigits:digits}); }
    function fmtPx(n,d){
      const digits=Math.min(8,Math.max(0, d==null?8:d));
      return Number(n).toLocaleString(undefined,{minimumFractionDigits:digits, maximumFractionDigits:digits});
    }

    // ---------- WebSocket multi-stream ---------- //
    const wsHub = (()=>{
      const BASES = ['wss://stream.binance.com:9443/stream','wss://data-stream.binance.vision/stream'];
      let hostIdx = Math.floor(Math.random()*BASES.length);
      let ws = null, connected=false, sendQueue=[];
      const want = new Set();
      const listeners = new Map();
      let backoff = 2000; const MAX_BACKOFF=30000;

      function url(){ return BASES[hostIdx%BASES.length]; }
      function ensureOpen(){
        if (ws && (ws.readyState===WebSocket.OPEN || ws.readyState===WebSocket.CONNECTING)) return;
        try{ ws && ws.close(); }catch{}
        ws = new WebSocket(url());
        ws.onopen = ()=>{
          connected = true;
          for (const msg of sendQueue){ try{ ws.send(JSON.stringify(msg)); }catch{} }
          sendQueue.length = 0;
          if (want.size){
            try{ ws.send(JSON.stringify({method:'SUBSCRIBE', params:[...want], id:Date.now()})); }catch{}
          }
          backoff = 2000;
        };
        ws.onclose = ()=>{
          connected=false;
          hostIdx=(hostIdx+1)%BASES.length;
          setTimeout(ensureOpen, backoff + Math.floor(Math.random()*700));
          backoff = Math.min(Math.round(backoff*1.7), MAX_BACKOFF);
        };
        ws.onerror = ()=>{};
        ws.onmessage = (ev)=>{
          let raw; try{ raw = JSON.parse(ev.data); }catch{ return; }
          if (raw && Object.prototype.hasOwnProperty.call(raw,'result')) return; // acks
          const stream = raw.stream || '';
          const data = raw.data || raw;
          if (!stream) return;

          const [symLower, rest] = stream.split('@');
          const type = (rest||'').toLowerCase();
          const sym = symLower ? symLower.toUpperCase() : '';
          const handler = listeners.get(sym);
          if (!sym || !handler) return;

          if (type.startsWith('trade')) handler({type:'trade', data});
          else if (type.startsWith('aggtrade')) handler({type:'aggTrade', data});
        };
      }
      function send(msg){
        if (connected && ws && ws.readyState===WebSocket.OPEN){
          try{ ws.send(JSON.stringify(msg)); }catch{ sendQueue.push(msg); }
        }else{
          sendQueue.push(msg);
          ensureOpen();
        }
      }
      function subscribe(sym, types, handler){
        const base = sym.toLowerCase();
        const params = (Array.isArray(types)?types:[types]).map(t=> `${base}@${t}`);
        let changed=false;
        for (const k of params){ if(!want.has(k)){ want.add(k); changed=true; } }
        listeners.set(sym.toUpperCase(), handler);
        ensureOpen();
        if (connected && changed) send({method:'SUBSCRIBE', params, id:Date.now()});
      }
      function unsubscribe(sym, types){
        const base = sym.toLowerCase();
        const params = (Array.isArray(types)?types:[types]).map(t=> `${base}@${t}`).filter(k=> want.has(k));
        if (params.length){
          for (const k of params) want.delete(k);
          if (connected) send({method:'UNSUBSCRIBE', params, id:Date.now()});
        }
        if (!types) listeners.delete(sym.toUpperCase());
      }
      return { ensureOpen, subscribe, unsubscribe };
    })();

    // ---------- Cards ---------- //
    function createCard(sym){
      const ids = idsFor(sym);
      const el = document.createElement('div');
      el.className = 'card';
      el.id = ids.card;
      el.innerHTML = `
        <div class="head">
          <div class="head-top">
            <span class="pill">${sym}</span>
            <span class="grow"></span>
            <span>Price: <span id="${ids.price}" class="price">—</span></span>
            <button class="close" title="Close card">❌</button>
          </div>
          <div class="head-bottom">
            <span id="${ids.status}" class="status">Connecting…</span>
          </div>
        </div>

        <div class="tblwrap">
          <table>
            <thead><tr><th>Price (quote)</th><th>Quantity (base)</th><th>Time</th></tr></thead>
            <tbody id="${ids.tbody}"></tbody>
          </table>
        </div>
      `;
      el.querySelector('.close').addEventListener('click', ()=> removeSymbol(sym));
      grid.appendChild(el);
      return el;
    }

    function removeSymbol(sym){
      // HUB leiratkozás
      wsHub.unsubscribe(sym, ['trade','aggTrade']);
      const rec = active.get(sym);
      if (rec && rec.guard) clearTimeout(rec.guard);
      active.delete(sym);
      const ids = idsFor(sym);
      const card = document.getElementById(ids.card);
      if (card) card.remove();
      saveList();
    }

    // ---------- Open symbol (HUB + trade + fallback) ---------- //
    async function openSymbol(sym){
      sym = sym.toUpperCase();
      if (!/^[A-Z0-9]{6,}$/.test(sym)) return;
      if (active.has(sym)) return;
      if (active.size >= 4){ alert('You’ve reached the 4-card limit. Close a card to add a new one.'); return; }

      createCard(sym);
      setStatus(sym, 'Connecting…');

      const ids    = idsFor(sym);
      const priceEl= document.getElementById(ids.price);
      const tbody  = document.getElementById(ids.tbody);

      const rec = {
        streamType:'trade', firstMsg:false, guard:null,
        priceDec:8, qtyDec:8
      };
      active.set(sym, rec);

      (async ()=>{
        const info = await fetchExchangeInfo(sym);
        if (info){ rec.priceDec = info.priceDecimals; rec.qtyDec = info.qtyDecimals; }
      })();

      function onTick(payload){
        const {type, data} = payload;
        if (type !== rec.streamType) return;

        const t = parseTradeToCommon(data);
        if (!t) return;

        if (!rec.firstMsg){
          rec.firstMsg = true;
          setStatus(sym, 'Live');
        }

        const d = rec.priceDec;
        priceEl.textContent = fmtPx(t.price, d);

        const tr = document.createElement('tr');
        tr.className = t.isBuyerMaker ? 'down' : 'up';
        tr.innerHTML =
          `<td>${fmtPx(t.price, d)}</td>`+
          `<td>${fmtQty(t.qty, rec.qtyDec)}</td>`+
          `<td>${humanTime(t.time)}</td>`;
        tbody.prepend(tr);

        const maxRows = Math.max(25, Math.min(250, parseInt(limitEl.value||'25',10)));
        while (tbody.rows.length > maxRows) tbody.deleteRow(-1);
      }

      setStatus(sym, 'Subscribing (trade)…');
      wsHub.subscribe(sym, ['trade'], onTick);

      if (rec.guard) clearTimeout(rec.guard);
      rec.guard = setTimeout(()=>{
        if (!active.has(sym)) return;
        if (!rec.firstMsg){
          setStatus(sym, 'No trade ticks → switching to aggTrade…');
          wsHub.unsubscribe(sym, ['trade']);
          rec.streamType = 'aggTrade';
          wsHub.subscribe(sym, ['aggTrade'], onTick);
        }
      }, 3000);

      saveList();
    }

    // ---------- Normalisation ---------- //
    function parseTradeToCommon(d){
      const price = parseFloat(d.p);
      const qty   = parseFloat(d.q);
      const time  = d.T ?? d.E;
      const isBuyerMaker = !!d.m;
      if(!Number.isFinite(price) || !Number.isFinite(qty) || !Number.isFinite(Number(time))) return null;
      return { price, qty, time:Number(time), isBuyerMaker };
    }

    // ---------- Add / limit ---------- //
    function parsePairs(txt){
      return String(txt||'').split(/[\s,;]+/).map(s=>s.trim().toUpperCase()).filter(s=>/^[A-Z0-9]{6,}$/.test(s));
    }
    function addSymbolsLimited(list){
      const syms = list.map(s=>s.toUpperCase()).filter(s=>/^[A-Z0-9]{6,}$/.test(s));
      const newOnes = syms.filter(s=>!active.has(s));
      let remaining = 4 - active.size;
      if (remaining<=0){ alert('You’ve reached the 4-card limit. Close a card to add a new one.'); return; }
      const toOpen = newOnes.slice(0,remaining);
      const skipped = newOnes.slice(remaining);
      toOpen.forEach(s=>openSymbol(s));
      if (skipped.length) alert('Skipped due to the 4-card limit: '+skipped.join(', '));
    }
    function addSymbolsFromInput(){
      const raw = symbolsInput.value.trim();
      if (!raw){ symbolsInput.value = [...active.keys()].join(','); return; }
      const syms = parsePairs(raw);
      if (!syms.length) return;
      addSymbolsLimited(syms);
      symbolsInput.value = ''; localStorage.setItem(LS.lastInput,'');
    }
    addBtn.addEventListener('click', addSymbolsFromInput);
    clearBtn.addEventListener('click', ()=>{ [...active.keys()].forEach(s=>removeSymbol(s)); });

    // ---------- Settings drawer ---------- //
    btnSettings.addEventListener('click', ()=>{
      const {pairs, limit} = loadUserDefaults();
      defPairsEl.value = pairs.join(', ');
      defLimitEl.value = limit;
      drawer.classList.add('open');
    });
    btnCloseSettings.addEventListener('click', ()=> drawer.classList.remove('open'));

    btnSaveDefaults.addEventListener('click', ()=>{
      let pairsArr = parsePairs(defPairsEl.value);
      pairsArr = Array.from(new Set(pairsArr)).slice(0,4);
      defPairsEl.value = pairsArr.join(', ');
      const lim = Math.max(25, Math.min(250, parseInt(defLimitEl.value||DEFAULT_FALLBACK_LIMIT,10)));
      try{
        localStorage.setItem(LS.defPairs, JSON.stringify(pairsArr.length ? pairsArr : DEFAULT_FALLBACK_PAIRS.slice(0,4)));
        localStorage.setItem(LS.defLimit, String(lim));
      }catch{}
      updateDefaultBadge();
    });

    btnApplyDefaults.addEventListener('click', ()=>{
      let pairsArr = parsePairs(defPairsEl.value);
      pairsArr = Array.from(new Set(pairsArr)).slice(0,4);
      if (!pairsArr.length) pairsArr = DEFAULT_FALLBACK_PAIRS.slice(0,4);
      defPairsEl.value = pairsArr.join(', ');

      const lim = Math.max(25, Math.min(250, parseInt(defLimitEl.value||DEFAULT_FALLBACK_LIMIT,10)));
      try{
        localStorage.setItem(LS.defPairs, JSON.stringify(pairsArr));
        localStorage.setItem(LS.defLimit, String(lim));
      }catch{}
      updateDefaultBadge();

      [...active.keys()].forEach(s => removeSymbol(s));

      limitEl.value = String(lim);
      saveLimit();
      addSymbolsLimited(pairsArr);

      drawer.classList.remove('open');
    });

    // ---------- Help drawer ---------- //
    btnHelp.addEventListener('click', ()=> helpDrawer.classList.add('open'));
    btnCloseHelp.addEventListener('click', ()=> helpDrawer.classList.remove('open'));

    // ---------- Init ---------- //
    (function init(){
      updateDefaultBadge();
      loadLimit();
      wsHub.ensureOpen();
      const list = loadList();
      list.forEach(s=>openSymbol(s));
    })();

    // ---------- Clean ---------- //
    window.addEventListener('beforeunload', ()=>{
      for (const s of active.keys()){ wsHub.unsubscribe(s, ['trade','aggTrade']); }
    });

  })();
  </script>
  </body>
</html>
